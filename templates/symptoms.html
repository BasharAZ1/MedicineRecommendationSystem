<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Symptoms</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/symptoms.css') }}">
</head>
<body>
    <div id="navbar">
        {% include 'navbar.html' %}
    </div>
    <div class="container">
        <div class="box">
            <h2>Select Symptoms</h2>
            <div class="search-box">
                <input type="text" id="symptom-search" placeholder="Search for symptoms...">
                <ul id="symptom-list"></ul>
            </div>
        </div>
        <div class="table-container">
            <h2>Selected Symptoms</h2>
            <table id="selected-symptoms-table">
                <thead>
                    <tr>
                        <th>Symptom</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Selected symptoms will be added here -->
                </tbody>
            </table>
            <form method="POST" id="symptom-form" action="/submit_symptoms">
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>

    <script>
        const symptoms = {{ symptoms|tojson }};
        const searchInput = document.getElementById('symptom-search');
        const symptomList = document.getElementById('symptom-list');
        const selectedSymptomsTable = document.getElementById('selected-symptoms-table').querySelector('tbody');
        const symptomForm = document.getElementById('symptom-form');

        searchInput.addEventListener('input', function() {
            const query = searchInput.value.toLowerCase();
            symptomList.innerHTML = '';
            if (query) {
                const filteredSymptoms = symptoms.filter(symptom => symptom.toLowerCase().includes(query)).slice(0, 5);
                filteredSymptoms.forEach(symptom => {
                    const li = document.createElement('li');
                    li.textContent = symptom.replace(/_/g, ' ');
                    li.addEventListener('click', () => selectSymptom(symptom));
                    symptomList.appendChild(li);
                });
            }
        });

        function selectSymptom(symptom) {
            if (document.querySelector(`input[value="${symptom}"]`)) {
                return; // Prevent adding the same symptom more than once
            }

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'symptoms';
            input.value = symptom;
            symptomForm.appendChild(input);

            addSymptomToTable(symptom);
        }

        function addSymptomToTable(symptom) {
            const row = document.createElement('tr');
            const cellSymptom = document.createElement('td');
            const cellAction = document.createElement('td');
            const deleteBtn = document.createElement('button');

            cellSymptom.textContent = symptom.replace(/_/g, ' ');
            deleteBtn.textContent = 'Remove';
            deleteBtn.addEventListener('click', () => {
                row.remove();
                document.querySelector(`input[value="${symptom}"]`).remove();
            });

            cellAction.appendChild(deleteBtn);
            row.appendChild(cellSymptom);
            row.appendChild(cellAction);
            selectedSymptomsTable.appendChild(row);
        }
    </script>
    <script src="{{ url_for('static', filename='js/find_med.js') }}"></script>
</body>
</html>
